<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Property</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content class="property-details-content" [fullscreen]="true">
  <!-- Header with Image Carousel -->
  <div class="property-header">
    <!-- Image Carousel -->
    <div class="image-carousel">
      <div class="carousel-container">
        <img [src]="property.images[currentImageIndex]?.url" [alt]="property.title" class="property-image">

        <!-- Navigation Arrows -->
        <ion-button fill="clear" class="nav-arrow left-arrow" (click)="previousImage()"
          *ngIf="property.images.length > 1">
          <ion-icon name="chevron-back" slot="icon-only"></ion-icon>
        </ion-button>

        <ion-button fill="clear" class="nav-arrow right-arrow" (click)="nextImage()" *ngIf="property.images.length > 1">
          <ion-icon name="chevron-forward" slot="icon-only"></ion-icon>
        </ion-button>

        <!-- Image Indicators -->
        <div class="image-indicators" *ngIf="property.images.length > 1">
          <span *ngFor="let image of property.images; let i = index" class="indicator"
            [class.active]="i === currentImageIndex" (click)="currentImageIndex = i">
          </span>
        </div>
      </div>

      <!-- Floating Header Actions -->
      <div class="header-actions">

        <div class="right-actions">
          <ion-button slot="end" fill="clear" shape="round" class="action-btn" (click)="shareProperty()">
            <ion-icon slot="icon-only" name="share-outline"></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>
  </div>

  <!-- Property Details Content -->
  <div class="property-content">
    <!-- Price and Basic Info -->
    <div class="price-section">
      <div class="price-info">
        <h1 class="property-title">{{ property.title }}</h1>
        <div class="price-details">
          <span class="rent-amount">₹{{ property.rent.toLocaleString('en-IN') }}<small>/month</small></span>
          <span class="deposit-amount">₹{{ property.deposit.toLocaleString('en-IN') }} deposit</span>
        </div>
      </div>
    </div>

    <!-- Description -->
    <div class="description-section">
      <h3>Description</h3>
      <p>{{ property.description }}</p>
    </div>

    <!-- Property Details Grid -->
    <div class="details-grid">
      <div class="detail-item">
        <ion-icon name="home" class="detail-icon"></ion-icon>
        <div class="detail-content">
          <span class="detail-label">Property Type</span>
          <span class="detail-value">{{ property.propertyType }}</span>
        </div>
      </div>

      <div class="detail-item">
        <ion-icon name="bed" class="detail-icon"></ion-icon>
        <div class="detail-content">
          <span class="detail-label">BHK Type</span>
          <span class="detail-value">{{ property.bhkType }}</span>
        </div>
      </div>

      <div class="detail-item">
        <ion-icon name="construct" class="detail-icon"></ion-icon>
        <div class="detail-content">
          <span class="detail-label">Furnishing</span>
          <span class="detail-value">{{ property.furnishing }}</span>
        </div>
      </div>

      <div class="detail-item">
        <ion-icon name="calendar" class="detail-icon"></ion-icon>
        <div class="detail-content">
          <span class="detail-label">Available From</span>
          <span class="detail-value">{{ getFormattedDate(property.availableFrom) }}</span>
        </div>
      </div>
    </div>

    <!-- Location Section -->
    <div class="location-section">
      <h3>
        <ion-icon name="location-outline"></ion-icon>
        Location
      </h3>
      <div class="address-card">
        <div class="building-name">{{ property.address.buildingName }}</div>
        <div class="address-details">
          {{ property.address.street }}, {{ property.address.city }}<br>
          {{ property.address.state }} {{ property.address.pincode }}
        </div>
        <div class="landmark" *ngIf="property.address.landmark">
          <ion-icon name="navigate-outline"></ion-icon>
          {{ property.address.landmark }}
        </div>
      </div>

      <!-- Map placeholder -->
      <div class="map-container">
        <div class="map-placeholder">
          <ion-icon name="map-outline"></ion-icon>
          <span>View on Map</span>
        </div>
      </div>
    </div>

    <!-- Amenities Section -->
    <div class="amenities-section">
      <h3>
        <ion-icon name="checkmark-circle-outline"></ion-icon>
        Amenities
      </h3>
      <div class="amenities-grid">
        <div class="amenity-item" *ngFor="let amenity of property.amenities">
          <ion-icon name="checkmark-circle" color="dark"></ion-icon>
          <span>{{ amenity }}</span>
        </div>
      </div>
    </div>

    <!-- Bottom Spacing -->
    <div class="bottom-spacing"></div>
  </div>

  <!-- Fixed Bottom Actions -->
  <div class="bottom-actions">
    <ion-button expand="block" fill="solid" class="contact-btn" (click)="contactOwner()">
      <ion-icon name="call-outline" slot="start"></ion-icon>
      Contact Owner
    </ion-button>
  </div>

  <ion-modal [isOpen]="isContactModalOpen" (didDismiss)="closeContactModal()" class="contact-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-button (click)="closeContactModal()" slot="start" fill="clear" shape="round" style="padding-left: 5px;" color="dark">
            <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
          </ion-button>
          <ion-title>Contact</ion-title>
        </ion-toolbar>
      </ion-header>

      <ion-content class="modal-content">
        <div class="contact-form-container">

          <form [formGroup]="contactForm" (ngSubmit)="onContactSubmit()">
            <!-- Phone Number Field -->
            <div class="input-group">
              <ion-input type="tel" formControlName="phoneNumber" placeholder="Enter your phone number" fill="outline"
                [class.error-input]="isFieldInvalid('phoneNumber')">
              </ion-input>
              <div *ngIf="isFieldInvalid('phoneNumber')" class="error-message">
                {{ getErrorMessage('phoneNumber') }}
              </div>
            </div>

            <!-- Message Field -->
            <div class="input-group">
              <ion-textarea formControlName="message" placeholder="Write your message here..." fill="outline" rows="4"
                [class.error-input]="isFieldInvalid('message')">
              </ion-textarea>
              <div class="character-count">
                {{ getCharacterCount() }}/500
              </div>
              <div *ngIf="isFieldInvalid('message')" class="error-message">
                {{ getErrorMessage('message') }}
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="button-group">
              <ion-button fill="clear" color="medium" (click)="closeContactModal()" class="cancel-button">
                Cancel
              </ion-button>

              <ion-button type="submit" [disabled]="contactForm.invalid" class="send-button">
                <ion-icon name="send-outline" slot="start"></ion-icon>
                Send Message
              </ion-button>
            </div>
          </form>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>